# 進捗管理レポート (2026-01-12)

## 1. プロジェクト概要
**プロジェクト名**: X-AUTO-POST-SYSTEM-otakuDJ
**目的**: イベント写真自動投稿システム（"CANDY虎太郎"ペルソナによる18文字エモコメント生成）
**フェーズ**: Phase 2.5 - ガバナンス強化 & リファクタリング
**担当**: Jules (AI Agent)

---

## 2. エグゼクティブ・サマリー
**【現状ステータス】**
- ✅ **V4.7 ベンチマーク完了**: 30枚の画像で検証済み（P06/P11/P12に偏る傾向あり）。
- ✅ **スコアリングロジック**: `kotaro_scoring_v4.py` にて V4.6.1 (De-Cluster) ロジック実装済み。
- ⚠️ **API競合**: `kotaro_api.py` (Local LLM) と `api/main.py` (Gemini) が共にポート8000を使用設定されており、競合リスクあり。
- ⚠️ **バージョン表記の揺れ**: `kotaro_api.py` のdocstringが `V3.0` だが、実装は `V4.2` であり、混乱の元となっている。

---

## 3. コンポーネント別ステータス

| コンポーネント | バージョン | ステータス | 課題 |
|:---|:---|:---|:---|
| **Kotaro API** | V4.2 (Imple) / V3.0 (Doc) | ⚠️ 混在 | バージョン表記の統一が必要。`call_kotaro_generation_v3` は旧来のまま。 |
| **Scoring Logic** | V4.6.1 | ✅ 稼働中 | `kotaro_scoring_v4.py` は最新ロジックを反映済み。 |
| **Vision Core** | MiniCPM-V 2.6 | ⏸️ スタンドアロン | `kotaro_api.py` は LMDeploy (Qwen2-VL) を使用しており、`vision_core.py` は未統合。 |
| **Frontend** | Next.js | ✅ 稼働中 | `localhost:8000` へ接続中（現在はKotaro APIを想定）。 |
| **Governance** | 2026-01-05版 | ✅ 準拠 | プロンプトは `Qwen_Core_Governance.md` に準拠済み。 |

---

## 4. コードレビュー検出事項 (2026-01-12)

### 1. API Double Management (Port 8000 Conflict)
- `kotaro_api.py`: `uvicorn.run(app, host="0.0.0.0", port=8000)`
- `api/main.py`: `uvicorn.run(app, host="0.0.0.0", port=8000)`
- **リスク**: 同時に起動できない、またはフロントエンドが意図しないAPIに接続する可能性。
- **推奨**: ポートの分離（例: Kotaro APIを8001へ）または統合。

### 2. Kotaro API Version Mismatch
- ファイル: `kotaro_api.py`
- Docstring: `Kotaro-Engine API (V3.0)`
- App Title: `Kotaro-Engine API (V4.2)`
- Logic: Generation関数名は `call_kotaro_generation_v3` だが、Scoringは `KotaroScorerV4`。
- **推奨**: コード全体をV4.x系として整理し、Docstringを更新する。

### 3. Vision Core Integration
- `vision_core.py` (MiniCPM-V) はメモリ効率が良い (int4) が、現在のメインフロー (`kotaro_api.py`) からは使用されていない。
- **推奨**: Qwen2-VL (LMDeploy) との使い分け方針の明確化。

---

## 5. Next Steps
1. **APIポート競合の解消**: ポート番号の変更または起動スクリプトでの制御。
2. **バージョン表記の修正**: `kotaro_api.py` のクリーンアップ。
3. **ベンチマーク偏りの分析**: P06/P11/P12への偏りを是正するためのパラメータ調整（必要に応じて）。

---
*Report generated by Jules on 2026-01-12*
