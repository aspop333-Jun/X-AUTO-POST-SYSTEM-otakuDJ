# 進捗管理レポート (2026-01-12)

## 1. プロジェクト概要
**プロジェクト名**: X-AUTO-POST-SYSTEM-otakuDJ (Kotaro Engine)
**目的**: イベント写真自動投稿システム（"CANDY虎太郎"ペルソナによる18文字エモコメント生成）
**現状ステータス**: フェーズ2.5（UI/UX統合・推論エンジン最適化）

本システムは、ローカルLLM（Qwen2-VL）を主軸とした画像解析・コメント生成エンジンとして稼働しています。`kotaro_api.py`を中心としたバックエンドと、`next-app`によるモダンなフロントエンドの統合が進んでいます。

---

## 2. コンポーネント別進捗詳細

### 🤖 AI エンジン (Kotaro Engine)
**ステータス: ✅ 稼働中 (V4.2 Logic / V3.0 Generation)**
- **Scoring (`kotaro_scoring_v4.py`)**:
  - **V4.6.1 Logic**: 12パターン判定に加え、De-Cluster（P01→P03分散）やB-gate制御が実装済み。
  - **Secondary Scoring**: フラグ（`casual_moment`など）に基づく二次加点ロジックが正常に機能。
- **Vision Integration**:
  - `kotaro_api.py` は `http://localhost:23334/v1` (LMDeploy) を使用して VLM 解析を実行。
  - `vision_core.py` (MiniCPM-V 2.6 int4) はスタンドアロン実装として存在しますが、APIサーバーからは直接使用されていません（Plan B構成）。
- **Generation Logic**:
  - 現在 `call_kotaro_generation_v3` を使用しており、V4で定義された `mods` (文体制御) や `bone` (骨子) が生成プロンプトに完全には反映されていない状態です。

### 💻 フロントエンド (`next-app`)
**ステータス: ✅ 統合進行中**
- **TextEditor.tsx**:
  - `http://localhost:8000/generate` への接続を実装済み。
  - **ScoringVisualization**: AIの判定結果（パターン、スコア、検出フラグ）を視覚的に表示するコンポーネントが統合されています。
  - **機能**: Zen Mode、絵文字ピッカー、人物情報ペースト機能などが実装済み。
- **Feedback**:
  - 生成されたコメントに対する「いいね」フィードバック機能（`/feedback/like`）が実装済み。

### ☁️ クラウド連携 / 旧API
**ステータス: ⚠️ 重複管理**
- **API (`api/main.py`)**:
  - Geminiを利用したAPIサーバーが残存しており、ポート `8000` を使用する設定になっています。
  - `kotaro_api.py` もポート `8000` を使用するため、同時起動時に競合するリスクがあります。

---

## 3. コードベースレビュー結果

### ⚠️ 課題と改善点

1.  **APIポートの競合 (Double Management)**
    - `kotaro_api.py` と `api/main.py` が共にポート `8000` をデフォルトとしています。
    - **推奨**: `api/main.py` を `8001` に変更するか、不要であればアーカイブ化する。現在は `kotaro_api.py` がメインのようです。

2.  **生成ロジックのバージョン乖離**
    - スコアリングは **V4.6.1** ですが、コメント生成関数は **V3.0** (`call_kotaro_generation_v3`) のままです。
    - V4で導入された「親近感(E)による文体変化（Mods）」が反映されきっていません。
    - **推奨**: `call_kotaro_generation_v4` の実装、またはV3関数のアップグレード。

3.  **ドキュメンテーションの不整合**
    - `kotaro_api.py` のファイル冒頭docstringが `(V3.0)` となっていますが、実装は `(V4.2)` です。

### 🔍 注目ファイル
- **`kotaro_scoring_v4.py`**: ロジックが複雑化していますが、分離されており管理しやすい状態です。
- **`vision_core.py`**: 非常にクリーンな実装ですが、現在のメインフローから外れています。バックアップとして維持推奨。

---

## 4. 今後のアクションプラン (Next Steps)

### 短期目標
1.  **APIポート競合の解消**:
    - `api/main.py` のポート変更または整理。
2.  **生成ロジックのV4化**:
    - `kotaro_api.py` 内の生成プロンプトを更新し、`mods` (close/polite/normal) を反映させる。
3.  **ドキュメント整備**:
    - APIのdocstring修正。

### 中期目標
1.  **Vision Coreの統合検討**:
    - LMDeployサーバーが重い場合、`vision_core.py` (MiniCPM) を `kotaro_api.py` に組み込む（インプロセス化）ことを検討。
2.  **ベンチマーク強化**:
    - V4.6.1の判定精度を継続的に検証。

---
*Report generated by Jules (AI Agent)*
