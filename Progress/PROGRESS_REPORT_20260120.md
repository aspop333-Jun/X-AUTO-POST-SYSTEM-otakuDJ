# 進捗管理レポート (2026-01-20) - 全コードレビュー & ステータス更新

## 1. プロジェクト概要
**プロジェクト名**: X-AUTO-POST-SYSTEM-otakuDJ (Kotaro-Engine)
**現在フェーズ**: Phase 2.5 (Refinement & Integration) - リファクタリングと整合性確保
**シミュレーション日時**: 2026-01-20

## 2. エグゼクティブ・サマリー
本日のタスクとして、プロジェクト全体のコードレビューを実施しました。
現在、機能実装自体は進んでいますが、**「起動スクリプトの不整合」**と**「APIの二重管理」**という重大なブロッキング要素が発見されました。これらはシステムの正常起動を妨げる要因となります。

---

## 3. コードレビュー結果 (詳細)

### 🚨 Critical Issues (緊急対応が必要)

#### 1. バックエンド起動構成の不整合 (`start_kotaro.sh` vs `kotaro_api.py`)
- **現状**: `kotaro_api.py` は **LMDeploy (port 23334)** をバックエンドとして使用するようにハードコードされています。
- **問題**: しかし、WSL用の起動スクリプト `start_kotaro.sh` は **Ollama** を起動しようとしています。
- **影響**: スクリプト経由で起動すると、APIサーバーはLMDeployを見つけられず、機能しません。
- **推奨**: `start_kotaro.sh` を修正し、`scripts/launch_qwen2.py` (LMDeploy) を呼び出すように変更する必要があります。

#### 2. APIポートの競合 / 二重管理 (`api/main.py` vs `kotaro_api.py`)
- **現状**:
    - `kotaro_api.py`: ローカルLLM (Qwen) ベースの本番API (Port 8000)
    - `api/main.py`: Gemini APIベースのAPI (Port 8000)
- **問題**: 両方のファイルが Port 8000 を奪い合っています。また、プロジェクト内に2つの異なるアーキテクチャが混在しており、混乱の元です。
- **推奨**: `api/main.py` を廃止するか、ポートを変更し、`kotaro_api.py` を正とする必要があります。

### ⚠️ Warning (改善推奨)

#### 3. フロントエンドの未実装箇所 (`ImageEditor.tsx`)
- 右クリックメニューの「Generate Comment」が `console.log` のみで実装されていません。
- 現状のコメント生成は `TextEditor.tsx` 側で行われていますが、画像編集画面からも生成フローに入れるような導線があるにも関わらず機能していない状態です。

#### 4. バージョン表記の揺れ
- `kotaro_api.py` のヘッダー: `V3.0`
- APIレスポンス内のバージョン: `V4.2`
- ベンチマーク・実運用ロジック: `V4.7` (Phase 2.5)
- これにより、デバッグ時にどのロジックが動いているか混乱する可能性があります。

#### 5. `vision_core.py` の孤立
- MiniCPM-V (int4) を使用する `vision_core.py` が存在しますが、現在の `kotaro_api.py` は LMDeploy (Qwen2-VL) を使用しており、このモジュールは現在使われていません。リソースの無駄か、あるいはフォールバックとして明示的に組み込むかの判断が必要です。

---

## 4. リスク管理

| リスク項目 | 重要度 | 内容 | 対応策 |
|:---|:---|:---|:---|
| **WSL環境起動不可** | **High** | 起動スクリプトが誤ったバックエンド(Ollama)を立ち上げるため、システムが動作しない。 | スクリプトの書き換え (Next Step) |
| **API競合** | **High** | 2つのAPIサーバーが存在し、ポートが衝突する。 | `api/main.py` の退避または削除 |
| **スコアリング不均衡** | Medium | ベンチマーク(V4.7)において P01, P05, P08-P10 が全く出力されない。 | プロンプト/スコアリングロジックの調整 |
| **依存関係の肥大化** | Low | `requirements.txt` に Ollama と LMDeploy 関連が混在する可能性。 | 不要なライブラリの整理 |

---

## 5. Next Steps (優先順位順)

1.  **[Infra] `start_kotaro.sh` の修正**
    - Ollama の起動ロジックを削除し、Windows側と同様に `scripts/launch_qwen2.py` を呼び出す形に変更する。
2.  **[Backend] `kotaro_api.py` のバージョン表記統一**
    - ヘッダーおよび内部バージョン変数を `V4.7` に更新する。
3.  **[Cleanup] 不要ファイルの整理**
    - `api/main.py` を `deprecated/` に移動するか、開発用ポート(8001等)に逃がす。
4.  **[Frontend] `ImageEditor.tsx` の機能接続**
    - "Generate Comment" を実際のAPI呼び出しに接続するか、機能自体を非表示にする。

---
*Report generated by Jules (AI Agent) on 2026-01-20*
