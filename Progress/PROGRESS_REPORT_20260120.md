# 進捗管理レポート (2026-01-20)

## 1. プロジェクト概要
**プロジェクト名**: X-AUTO-POST-SYSTEM-otakuDJ
**目的**: イベント写真自動投稿システム（"CANDY虎太郎"ペルソナによる18文字エモコメント生成）
**現状ステータス**: Phase 2.5 (Refinement & Integration) - 論理不整合の解消とレガシー排除

本フェーズでは、V4系エンジンのスコアリング精度向上（Benchmark V4.7）と、フロントエンド（Next.js）との完全統合に向けた準備を進めています。また、開発環境（WSL2/LMDeploy）への完全移行に伴うスクリプトの整備が急務となっています。

---

## 2. コンポーネント別進捗詳細

### 🤖 AI エンジン (Kotaro Engine)
**ステータス: ✅ 稼働中 (V4.2)**
- **API (`kotaro_api.py`)**:
  - ヘッダーバージョンを V3.0 → **V4.2** に修正しました。
  - VLM分析 (`call_vlm_analysis_v4`) は `Qwen2-VL-2B-Instruct` を使用し、A-Eスコアとフラグ判定を行っています。
  - **課題**: ポート `8000` が `api/main.py` (Gemini系) と競合する構造的リスクは継続中。

- **ベンチマーク (V4.7)**:
  - **最新結果**: `Progress/V4_7_BENCHMARK_REPORT.md`
  - **傾向**: P06 (30%), P11 (26.7%), P12 (26.7%) が全体の8割以上を占有。
  - **問題点**: 感情系パターン（P01, P05, P08-P10）の出現率が **0%**。スコアリングロジックまたはプロンプトの調整が必要です。

### 💻 フロントエンド
**ステータス: 🏗️ 開発中 (Next.js)**
- **ImageEditor (`next-app/src/components/editor/ImageEditor.tsx`)**:
  - 画像クロップ (`react-cropper`) やフィルタ調整機能は実装済み。
  - **未実装 (TODO)**:
    - `onGenerateComment`: AI生成APIとの接続が未完了（ログ出力のみ）。
    - `onFactCheck`: バックエンド接続はあるが検証待ち。
    - `onExtractMetadata`: 実装なし。

### 🏗️ インフラストラクチャ
**ステータス: ⚠️ 注意あり**
- **起動スクリプト (`start_kotaro.sh`)**:
  - **重大な問題**: 現在のスクリプトは `ollama serve` を起動しようとしますが、現在のシステム構成（LMDeploy/Qwen2-VL）とは整合していません。
  - **修正方針**: `scripts/launch_qwen2.py` を呼び出す形（`start_lmdeploy_system.bat` のWSL版）へ修正が必要です。
- **レガシー排除**:
  - `kotaro_v2.py` (非推奨) を削除しました。

---

## 3. コードベースレビュー結果

### ✅ 修正完了
1.  **バージョン表記の統一**: `kotaro_api.py` のヘッダーを実態に合わせて V4.2 に更新。
2.  **不要ファイルの削除**: `kotaro_v2.py` を削除し、混乱を排除。

### ⚠️ 検出されたリスク
1.  **スコアリングの偏り (Imbalance)**:
    - 特定のパターン（P06:衣装、P11:接近、P12:無難）に判定が集中しており、"エモい"コメント（P01, P08等）が出にくい状態です。
2.  **WSL起動環境の不整合**:
    - Linux/WSL環境で `start_kotaro.sh` を叩くと、期待されるLMDeployではなくOllamaが立ち上がり、V4.2 APIが正常に機能しない可能性があります。

---

## 4. 今後のアクションプラン (Next Steps)

### 優先度: 高 (High)
1.  **起動スクリプトの修正**:
    - `start_kotaro.sh` を書き換え、`scripts/launch_qwen2.py` をポート 23334 で起動するように変更する。
2.  **フロントエンド接続**:
    - `ImageEditor.tsx` の `onGenerateComment` 内で、`kotaro_api.py` (`/generate`) を呼び出す処理を実装する。

### 優先度: 中 (Medium)
1.  **スコアリングロジック調整**:
    - P06/P11/P12 の判定閾値を厳格化し、他のパターンの出現率を上げる（目標: 各パターン10%前後）。
2.  **APIポート競合の解消**:
    - `kotaro_api.py` のポートを `8001` 等に変更するか、統合ランチャーを作成する。

---
*Report generated by Jules (AI Agent)*
