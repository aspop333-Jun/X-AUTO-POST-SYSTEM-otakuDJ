# 進捗管理レポート (2026-01-14)

## 1. プロジェクト概要
**プロジェクト名**: X-AUTO-POST-SYSTEM-otakuDJ
**目的**: イベント写真自動投稿システム（"CANDY虎太郎"ペルソナによる18文字エモコメント生成）
**現状ステータス**: フェーズ2.5（リファインメント＆統合）

ローカルLLM（Qwen/MiniCPM）を中心とした「最短で勝つインフラ戦略」が定着し、推論パイプラインは安定稼働しています。現在はスコアリング精度の向上（V4系）とフロントエンド（Next.js）への完全統合を進めるフェーズです。

---

## 2. コンポーネント別進捗詳細

### 🤖 AI エンジン (Kotaro Engine)
**ステータス: ⚠️ バージョン混在 (V4.2 Logic / V3.0 Generation)**
- **Scoring (`kotaro_scoring_v4.py`)**:
  - V4.6.1 (De-Cluster) ロジックが稼働中。12パターンへの分類は機能していますが、ベンチマークにて特定のパターン（P06, P11, P12）への偏りが確認されています。
- **Generation (`kotaro_api.py`)**:
  - `call_kotaro_generation_v3` を使用しており、V4で判定された「文体（mods）」や「骨子（bone）」が生成プロンプトに反映されていません。
  - **課題**: 判定は最新だが、出力は旧来のままという「頭でっかち」な状態です。

### 💻 フロントエンド
**ステータス: 🔄 移行中**
- **Visualization (`ScoringVisualization.tsx`)**:
  - V3.0のA-EスコアとV4のフラグ表示には対応済みですが、コード内にレガシーな `CRITERIA_DEFINITIONS`（A01-D15の60項目）が残存しており、保守性を下げています。
- **Integration**:
  - `TextEditor.tsx` からの接続は確認されていますが、`ImageEditor.tsx` は未接続です。

### 🛡️ ガバナンス
**ステータス: ✅ 改訂済み (2026-01-05)**
- **Compliance**:
  - `QWEN_GOVERNANCE_REFACTOR_20260105.md` に準拠。
  - **軽微な矛盾**: 評価基準（P07）の定義には「尊い」という言葉が含まれていますが、生成禁止ワードにも「尊い」が含まれています。内部ロジックと出力規制の用語統一が必要です。

---

## 3. コードベースレビュー結果

### ⚠️ 優先的課題

1.  **Backend: ロジックと生成の乖離**
    - `kotaro_api.py` 内で `scorer.decide_pattern` (V4) が返した `mods`（文体指定）が、`call_kotaro_generation_v3` に渡されていません。
    - **影響**: 判定精度が上がっても、コメントのバリエーションが増えない（同じようなコメントばかりになる）。

2.  **Frontend: レガシーコードの残存**
    - `ScoringVisualization.tsx` 内の `CRITERIA_DEFINITIONS` は現在のバックエンド（A-E + Flags）と一致していません。
    - **推奨**: 削除し、APIから返される `flags` を動的に表示する仕様へ完全移行する。

3.  **Benchmark: スコアの偏り**
    - 最新レポート (`V4_7_BENCHMARK_REPORT.md`) によると、P06, P11, P12 で全体の約83%を占めています。
    - **感情系（P01, P05, P08-P10）がほぼ死滅**しており、エモさが不足しています。

### 🔍 注目ファイル
- **`kotaro_api.py`**: V4化の過渡期でコードが肥大化しています。V3生成ロジックをV4対応にアップデートする必要があります。
- **`vision_core.py`**: 引き続き安定しており、変更の必要はありません。

---

## 4. 今後のアクションプラン (Next Steps)

### 短期目標 (今週)
1.  **AI生成ロジックの統合 (V4 Generation)**:
    - `kotaro_api.py` の生成関数を更新し、V4スコアラーが決定した `mods`（甘め、塩対応、限界オタク等）をプロンプトに反映させる。
2.  **フロントエンドのクリーンアップ**:
    - `ScoringVisualization.tsx` から不要な定義を削除。
3.  **スコアリング調整**:
    - P06/P11/P12 の判定閾値を厳格化し、他のパターンの出現率を上げる。

### 中期目標 (今月)
1.  **API二重管理の解消**:
    - `api/main.py` (Gemini) の機能を `kotaro_api.py` に統合、または明確なゲートウェイを設置する。
2.  **完全なWSL2移行**:
    - Windows側バッチファイルへの依存を減らす。

---
*Report generated by AI Code Reviewer (Jules)*
