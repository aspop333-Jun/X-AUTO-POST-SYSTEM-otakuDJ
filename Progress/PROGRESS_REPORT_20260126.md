# 進捗管理レポート (2026-01-26)

## 1. プロジェクト概要
**プロジェクト名**: X-AUTO-POST-SYSTEM-otakuDJ (Kotaro-Engine)
**目的**: イベント写真自動投稿システム（"CANDY虎太郎"ペルソナによる18文字エモコメント生成）
**現状ステータス**: Phase 3（UI統合）/ Phase 2.5（Refinement）

本日はコードベース全体のレビューを実施し、インフラ、API、フロントエンドの統合状況を確認しました。
特に「インフラ構成の乖離」と「APIの二重管理」が主要なリスクとして浮上しています。

---

## 2. コンポーネント別進捗詳細

### 🤖 AI エンジン (Kotaro Engine)
**ステータス: ✅ 稼働中 (V4.2 / LMDeploy)**
- **API (`kotaro_api.py`)**:
  - V4.2ロジックが実装済み。
  - バックエンドとして **LMDeploy (Port 23334)** を使用（Qwen2-VL-2B）。
  - `CommentCache` による重複防止、`KotaroScorerV4` (V4.6.1) による12パターン判定が稼働中。
- **Vision Core (`vision_core.py`)**:
  - MiniCPM-V 2.6 int4 (RTX 4060最適化) 版が単独で存在。
  - **現状**: メインの `kotaro_api.py` からは使用されておらず、Qwen2-VLに一本化されている状態。統合するか廃止するかの判断が必要。

### 💻 フロントエンド
**ステータス: 🏗️ 開発中 (Next.js)**
- **TextEditor (`TextEditor.tsx`)**:
  - API (`localhost:8000/generate`) との接続完了。
  - スコアリング可視化 (`ScoringVisualization`) 実装済み。
  - 「いいね」フィードバック機能実装済み。
- **ImageEditor (`ImageEditor.tsx`)**:
  - UI実装は完了（Cropper, Context Menu）。
  - **課題**: `onGenerateComment` などのロジックが未実装（`console.log` のみ）。Cameko検索機能もモック状態。

### 🏗️ インフラストラクチャ
**ステータス: ⚠️ 重大な不整合あり**
- **起動スクリプト (`start_kotaro.sh`)**:
  - **Ollama** を起動する構成になっていますが、`kotaro_api.py` は **LMDeploy** (Port 23334) を要求しています。
  - このままでは `./start_kotaro.sh` を実行してもAPIが正常に機能しません（バックエンド不在エラー）。

---

## 3. コードベースレビュー結果

### ⚠️ 優先度高 (Critical Issues)

1.  **起動スクリプトと実装の不整合**
    - `start_kotaro.sh`: `ollama serve` を実行。
    - `kotaro_api.py`: `LMDEPLOY_API_URL` (23334) に接続。
    - **対応**: `start_kotaro.sh` を修正し、`scripts/launch_qwen2.py` (または同等のLMDeploy起動コマンド) を呼び出すように変更する必要があります。

2.  **APIの二重管理 (Port Conflict)**
    - `kotaro_api.py` (Main): Port 8000
    - `api/main.py` (Legacy/Gemini): Port 8000
    - 双方が `api/` ディレクトリ付近に存在し、ポートが競合する可能性があります。`api/main.py` の機能を `kotaro_api.py` に統合（ハイブリッド化）し、廃止すべきです。

3.  **依存関係の不整合 (`requirements-kotaro.txt`)**
    - `ollama` が含まれていますが、現在は `lmdeploy` (または `openai` クライアント) が必要です。
    - `kotaro_api.py` は `openai` ライブラリを使用していますが、requirements に記載がありません。

### 🔍 注目点・課題
- **スコアリングの偏り**: ベンチマーク (V4.7) によると、P06/P11/P12 が支配的であり、エモーショナル系（P01/P05/P08-P10）が出にくい状態です。`kotaro_scoring_v4.py` の閾値調整が必要です。
- **Vision Coreの扱い**: MiniCPM-V (`vision_core.py`) は非常に高品質ですが、APIサーバーに組み込まれていません。リソース（VRAM 8GB）的に Qwen2-VL との共存が厳しいため、Qwen2-VL 一本化が現実解となりつつあります。

---

## 4. 今後のアクションプラン (Next Steps)

### 短期目標 (今週)
1.  **インフラ整合性の修正**:
    - `start_kotaro.sh` を書き換え、Ollamaを削除しLMDeployを起動するようにする。
    - `requirements-kotaro.txt` を整理（`openai` 追加、`ollama` 削除）。
2.  **API統合**:
    - `api/main.py` の Gemini フォールバックロジックを `kotaro_api.py` に移植。
    - `api/main.py` を削除。
3.  **フロントエンド機能実装**:
    - `ImageEditor.tsx` の実機能（Cameko検索、メタデータ抽出）をAPIに接続。

### 中期目標 (フェーズ完了まで)
1.  **スコアリング・チューニング**:
    - P06/P11/P12 の独占状態を解消するためのロジック調整 (V4.8)。
2.  **完全自動化**:
    - 画像投入から投稿までのフローをワンクリック化。

---
*Report generated by Jules (AI Agent)*
