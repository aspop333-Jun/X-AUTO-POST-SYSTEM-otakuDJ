# 進捗管理レポート (2026-01-03)

## 1. プロジェクト概要
**プロジェクト名**: X-AUTO-POST-SYSTEM-otakuDJ
**目的**: イベント写真自動投稿システム（"CANDY虎太郎"ペルソナによる18文字エモコメント生成）
**現状ステータス**: フェーズ2完了・フェーズ3（UI/UX統合）進行中

本システムは、ローカルLLM（Qwen/MiniCPM）とクラウドAPI（Gemini）のハイブリッド構成で開発が進められています。「最短で勝つインフラ戦略（Plan B）」に基づき、ローカル環境での推論最適化が完了し、Next.jsによるモダンなフロントエンド構築フェーズに移行しています。

---

## 2. コンポーネント別進捗詳細

### 🤖 AI エンジン (Kotaro Engine)
**ステータス: ✅ 稼働中 (Local/Hybrid)**
- **Vision Core (`vision_core.py`)**:
  - MiniCPM-V 2.6 int4 による画像解析が実装済み。
  - RTX 4060 (8GB VRAM) 向けにリサイズ処理(512px)やメモリ管理が最適化されています。
- **Comment Generation (`kotaro_api.py`, `kotaro_engine.py`)**:
  - `kotaro_api.py` がメインのAPIサーバーとして機能。
  - **Dynamic Few-shot** 機能を実装済み（感情や特徴に合わせた例文提示）。
  - **安全弁 (Safety Guard)** 実装済み（NGワード、中国語フィルタ、衣装の抽象化）。
  - **Ollama連携**: Qwen2.5-VL / Qwen2.5-7b-instruct を使用。

### ☁️ クラウド連携
**ステータス: ✅ 稼働中 (Fallback/Alternative)**
- **API (`api/main.py`)**:
  - Gemini 2.0 Flash (`google.generativeai`) を利用した高速推論ルート。
  - ローカルリソースが不足する場合や、簡易利用向けのフォールバックとして機能。

### 💻 フロントエンド
**ステータス: 🏗️ 開発中 (Next.js)**
- **構成**: Next.js 16 + React 19 + Tailwind CSS + Zustand
- **ディレクトリ**: `next-app/`
- **特徴**:
  - `framer-motion` によるアニメーション。
  - `react-cropper` による画像編集機能の兆候あり。
  - 従来の `app/` (Vanilla JS) からの移行が進んでいると推測されます。

### 🏗️ インフラストラクチャ
**ステータス: 🔄 移行過渡期**
- **Plan B (Ubuntu/WSL)**:
  - `setup_kotaro.sh` などのスクリプト整備完了。
  - 現在はWindows環境（`dev.bat`）でも動作するように設計されていますが、推奨はWSL2/Native Linuxへの移行です。

---

## 3. コードベースレビュー結果

### ⚠️ 課題と改善点

1.  **APIの二重管理**
    - `kotaro_api.py` (Local LLM用) と `api/main.py` (Gemini用) が別個に存在し、ポートも `8000` で競合する可能性があります。
    - **推奨**: 統合APIゲートウェイを作成するか、環境変数でバックエンドを切り替えられる単一のエントリポイントに統合する。

2.  **非推奨ファイルの残存**
    - `kotaro_v2.py`: コード内で `[DEPRECATED]` と明記されていますが、ファイルが残っています。混乱を避けるため、`deprecated/` フォルダへの移動または削除を推奨します。

3.  **TODOの実装待ち**
    - `scoring_criteria_draft.md`: 評価基準の策定がTODO。
    - `next-app/src/components/editor/ImageEditor.tsx`: メタデータ抽出やAI生成との連携がTODOとして残っています。

### 🔍 注目ファイル
- **`vision_core.py`**: シングルトンパターンとVRAM管理が適切に実装されており、品質が高いです。
- **`kotaro_api.py`**: 具体的なプロンプトエンジニアリング（"虎太郎"ペルソナ）がコード埋め込みになっています。これを外部設定ファイル（YAML/JSON）に出すと管理しやすくなります。

---

## 4. 今後のアクションプラン (Next Steps)

### 短期目標 (今週)
1.  **フロントエンド統合**:
    - `next-app` から `kotaro_api.py` (または `api/main.py`) を叩けるように接続を完了させる。
    - 画像アップロード → 解析 → コメント生成 → 編集 のUIフローを確立する。
2.  **クリーンアップ**:
    - `kotaro_v2.py` のアーカイブ化。
    - `app/` (旧フロントエンド) の扱いを決定（削除または参照用保存）。

### 中期目標 (今月)
1.  **API統合**:
    - ローカルモードとクラウドモードをスイッチできる統合APIサーバーの構築。
2.  **WSL2完全移行**:
    - 開発環境をWSL2ベースに統一し、Flash Attention等の最適化恩恵を最大化する。

---
*Report generated by Gemini CLI Agent*
