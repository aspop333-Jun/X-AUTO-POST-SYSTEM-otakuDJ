# 進捗管理レポート (2026-01-03)

## 1. プロジェクト概要
**プロジェクト名**: X-AUTO-POST-SYSTEM-otakuDJ
**目的**: イベント写真自動投稿システム（"CANDY虎太郎"ペルソナによる18文字エモコメント生成）
**現状ステータス**: フェーズ2完了・フェーズ3（UI/UX統合）進行中

本システムは、ローカルLLM（Qwen/MiniCPM）とクラウドAPI（Gemini）のハイブリッド構成で開発が進められています。「最短で勝つインフラ戦略（Plan B）」に基づき、ローカル環境での推論最適化が完了し、Next.jsによるモダンなフロントエンド構築フェーズに移行しています。

---

## 2. コンポーネント別進捗詳細

### 🤖 AI エンジン (Kotaro Engine)
**ステータス: ✅ 稼働中 (Local/Hybrid)**
- **Comment Generation (`kotaro_api.py`)**:
  - メインのAPIサーバーとして稼働 (Port 8000)。
  - **LMDeploy連携**: `http://localhost:23334` (Qwen2-VL) を経由した高速推論を実装。
  - **Governance順守**: `Kotaro Comment Generation Protocol` に基づく厳格なプロンプト制御（"emo"禁止、構造的称賛）が実装されています。
  - **課題**: コメント生成ロジックが `call_kotaro_generation_v3` (V3ベース) のままであり、V4のスコアリング要素（Mods等）を完全には活用しきれていないTODOが残っています。
- **Vision Core (`vision_core.py`)**:
  - MiniCPM-V 2.6 int4 を直接ロードするモジュール。
  - 現状の `kotaro_api.py` はLMDeployを使用しているため、このモジュールは**未使用**または**別ルート**での利用となっています（構成の重複）。

### ☁️ クラウド連携
**ステータス: ✅ 稼働中 (Fallback/Alternative)**
- **API (`api/main.py`)**:
  - `kotaro_api.py` とは別のFastAPIアプリケーション。
  - Gemini 2.0 Flash を利用。
  - ポート `8000` が `kotaro_api.py` と競合する設計になっています。

### 💻 フロントエンド
**ステータス: 🏗️ 開発中 (Next.js)**
- **構成**: `next-app/` (Next.js 16 + React 19)
- **ImageEditor (`src/components/editor/ImageEditor.tsx`)**:
  - UI実装は完了していますが、AI生成ボタン (`onGenerateComment`) は `console.log` のみのモック状態です。
  - `Cameko` 検索やファクトチェック機能の統合が進んでいます。

---

## 3. コードベースレビュー結果

### ⚠️ 課題と改善点

1.  **推論ルートの分断 (Inference Fragmentation)**
    - `kotaro_api.py` は **LMDeploy (HTTP)** を使用。
    - `vision_core.py` は **Transformers (Direct)** を使用。
    - **推奨**: リソース効率の観点から、`vision_core.py` のロジックをLMDeploy経由に統一するか、用途を明確に分離すべきです。

2.  **APIの二重管理**
    - `kotaro_api.py` (Local) と `api/main.py` (Cloud) が独立して存在し、ポート競合のリスクがあります。
    - 統合APIゲートウェイの構築が必要です。

3.  **V4ロジックの適用不完全**
    - `kotaro_scoring_v4.py` は高度なV4.3/V4.6ロジック（B-gate等）を持っていますが、最終的なコメント生成を行う `kotaro_api.py` の `call_kotaro_generation_v3` 関数は、V3時代の単純なパターン参照を行っています。V4の「Mods（文体）」を反映させる改修が必要です。

### ✅ 解決済み・進行中
- **非推奨ファイルの整理**: `kotaro_v2.py` を `deprecated/` ディレクトリへ移動完了しました。
- **Governance適合**: `kotaro_api.py` のプロンプトは `Qwen_Core_Governance.md` の「構造優先・感情脚色禁止」ルールに適合しています。

---

## 4. 今後のアクションプラン (Next Steps)

### 短期目標 (今週)
1.  **フロントエンド統合 (最優先)**:
    - `next-app/src/components/editor/ImageEditor.tsx` の `onGenerateComment` を実装し、`kotaro_api.py` の `/generate` エンドポイントに接続する。
2.  **API統合の検討**:
    - `kotaro_api.py` に `api/main.py` のGeminiフォールバックロジックを移植し、単一のエントリーポイントにする。

### 中期目標 (今月)
1.  **V4完全対応**:
    - コメント生成プロンプトをV4仕様（Mods対応）にアップデート。
2.  **インフラ整理**:
    - `vision_core.py` の扱い（廃止またはツール化）を決定。

---
*Report generated by Jules (AI Agent) - 2026-01-03*
