# 進捗管理レポート (2026-01-25)

## 1. プロジェクト概要
**プロジェクト名**: X-AUTO-POST-SYSTEM-otakuDJ
**目的**: イベント写真自動投稿システム（"CANDY虎太郎"ペルソナによる18文字エモコメント生成）
**現状ステータス**: フェーズ3（UI/UX統合）および インフラトラブルシューティング

現在、APIバックエンド(V4.2)とフロントエンド(Next.js)の統合フェーズにありますが、起動スクリプトとバックエンドの構成に不整合（Split-Brain問題）が発生しており、開発環境の安定化が最優先事項となっています。

---

## 2. コンポーネント別進捗詳細

### 🤖 AI エンジン (Kotaro Engine)
**ステータス: ⚠️ 構成不整合 (Split-Brain)**
- **API (`kotaro_api.py` V4.2)**:
  - LMDeploy (`localhost:23334`) をバックエンドとして想定して実装されています。
  - `kotaro_scoring_v4.py` (V4.6.1) による12パターン判定ロジックが組み込まれています。
- **起動スクリプト (`start_kotaro.sh`)**:
  - 現在、**Ollama (`localhost:11434`) を起動する設定**になっており、APIが想定するLMDeployが起動しません。これによりAPIサーバーがVLM機能を利用できない状態です。

### 💻 フロントエンド
**ステータス: 🏗️ 開発中 (Next.js)**
- **ImageEditor (`next-app/src/components/editor/ImageEditor.tsx`)**:
  - UI実装は進んでいますが、バックエンドAPI (`/generate`) との接続が未完了です。
  - 視覚機能（Cameko Search等）のプレースホルダーが残っています。

### 📊 スコアリング・ロジック
**ステータス: ⚠️ バイアス検知**
- **判定ロジック (`kotaro_scoring_v4.py`)**:
  - ベンチマーク結果より、P11/P12（Flat/Scene）への判定が過半数を占める偏りが確認されています。
  - コードレビューの結果、`top1_score <= 2.0` の場合に強制的に P11/P12 へ遷移する「Flat Escape」ロジックが、現在のVLMのスコア傾向（全体的に低く出る傾向）と噛み合っていないことが原因と推測されます。

---

## 3. コードベースレビュー結果

### ⚠️ 重大な課題 (Critical Issues)

1.  **インフラの「Split-Brain」状態**
    - **症状**: `start_kotaro.sh` が Ollama を起動するが、`kotaro_api.py` は LMDeploy (Port 23334) にリクエストを送る。
    - **影響**: ローカル環境で `kotaro_api.py` を起動しても、画像認識がタイムアウトまたはエラーになる。
    - **修正案**: `start_kotaro.sh` を修正し、`scripts/launch_qwen2.py` (LMDeploy) を起動するように変更する。

2.  **スコアリングの「Flat Escape」バイアス**
    - **症状**: 感情豊かな写真でもスコアが伸び悩み（例: A=1.8, B=1.5）、強制的に「無難（P11/P12）」に判定される。
    - **影響**: "CANDY虎太郎"の「エモい」コメントが生成されず、無難なコメントばかりになる。
    - **修正案**: Escape閾値を `2.0` から `1.5` 程度に下げる、またはVLMの出力スコアにゲタを履かせる（キャリブレーション）。

### 🔍 その他気付き
- **API命名の不一致**: `kotaro_api.py` 内で `call_kotaro_generation_v3` という関数名が使われていますが、中身は V4 ロジックで動作しています。混乱を避けるためリネーム推奨。
- **未使用ファイル**: `kotaro_v2.py` や `kotaro_engine.py` (Ollama依存の旧コード) がルートに残っており、開発者の混乱を招く可能性があります。

---

## 4. 今後のアクションプラン (Next Steps)

### 緊急対応 (Immediate)
1.  **起動スクリプトの修正**:
    - `start_kotaro.sh` を書き換え、Ollama依存を排除し、LMDeploy (`launch_qwen2.py`) を起動するようにする。
2.  **APIポート統合の検討**:
    - `api/main.py` (Gemini) と `kotaro_api.py` (Local) が共に Port 8000 を使用する競合を解決する（例: Localを8001にするか、統合ランチャーを作る）。

### 短期目標 (This Week)
1.  **フロントエンド接続**:
    - `ImageEditor.tsx` から `kotaro_api.py` へのPOST処理を実装し、E2Eでコメント生成ができるようにする。
2.  **スコアリング調整**:
    - `kotaro_scoring_v4.py` の閾値調整を行い、P01-P10（感情系パターン）の出現率を向上させる。

---
*Report generated by AI Audit Agent*
