# 進捗管理レポート (2026-01-19)

## 1. プロジェクト概要
**プロジェクト名**: X-AUTO-POST-SYSTEM-otakuDJ
**目的**: イベント写真自動投稿システム（"CANDY虎太郎"ペルソナによる18文字エモコメント生成）
**現状ステータス**: フェーズ2.5（Refinement & Integration）進行中

本システムは、ローカルLLM（Qwen2-VL）を核としたハイブリッド構成で開発が進んでいます。現在、推論精度の向上（V4.7ベンチマーク）とフロントエンド統合（Next.js）が並行して進行中ですが、インフラ起動スクリプトとバックエンド構成に乖離が見られ、修正が必要です。

---

## 2. コンポーネント別進捗詳細

### 🤖 AI エンジン (Kotaro Engine)
**ステータス: ⚠️ 構成不整合あり**
- **Core API (`kotaro_api.py`)**:
  - バージョン: V4.2 (5要素A-E × 4連単方式)
  - バックエンド: `LMDeploy` (localhost:23334) を前提に実装されています。
  - **課題**: 起動スクリプト `start_kotaro.sh` が依然として `Ollama` を起動する仕様になっており、APIサーバーがバックエンドに接続できない状態です。
- **Vision Core**:
  - `vision_core.py`: MiniCPM-V 2.6 int4 実装済み（RTX 4060最適化）。独立して動作可能。

### ☁️ クラウド連携
**ステータス: ⏸️ 待機中**
- **Fallback API (`api/main.py`)**:
  - Gemini 2.0 Flash を利用する実装が存在しますが、`kotaro_api.py` とポート8000で競合しています。
  - 現在は `kotaro_api.py` が主系として動作すべきフェーズです。

### 💻 フロントエンド
**ステータス: ✅ 統合進行中 (Next.js)**
- **Editor (`TextEditor.tsx`)**:
  - `http://localhost:8000/generate` への接続を実装済み。
  - `ScoringVisualization` コンポーネントにより、V4エンジンの判定ロジック（A-Eスコア、フラグ）を可視化可能。
  - **課題**: `ImageEditor.tsx` 内の `Cameko` 検索機能などが未実装またはモック状態。

### 📊 ベンチマーク結果 (V4.7)
**ステータス: ⚠️ バランス調整が必要**
- **レポート**: `V4_7_BENCHMARK_REPORT.md`
- **傾向**:
  - **P06 (衣装/キャラ)**: 30.0%
  - **P11 (視線/ドキッ)**: 26.7%
  - **P12 (楽しそう/瞬間)**: 26.7%
  - **欠落**: P01(表情), P05(クール), P08-P10(癒やし・アクション) が生成されていません。
  - **分析**: 判定ロジックが特定の「強いフラグ」（costume_strong等）に引きずられすぎており、感情系の微細なパターンが埋没しています。

---

## 3. コードベースレビュー結果

### 🚨 クリティカルな課題 (Priority: High)

1.  **起動スクリプトの不整合 (`start_kotaro.sh`)**
    - 現在のスクリプトは `ollama serve` を実行していますが、`kotaro_api.py` は `LMDeploy` (OpenAI互換EP: port 23334) を使用するようにハードコードされています。
    - **処置**: `scripts/launch_qwen2.py` を呼び出す形式に修正する必要があります。

2.  **ポート競合 (API Double Management)**
    - `kotaro_api.py` と `api/main.py` が共に `port=8000` を使用。
    - 現状の `dev.bat` 等がどちらを起動しているか不明瞭であり、意図しないバックエンドが立ち上がるリスクがあります。

### ⚠️ 改善推奨事項 (Priority: Medium)

1.  **非推奨ファイルの削除**
    - `kotaro_v2.py`: 以前より非推奨ですが、ルートに残存しています。
    - `deprecated/` ディレクトリを作成し、移動することを推奨。

2.  **依存関係の整理**
    - `requirements-kotaro.txt` に `ollama` が含まれていますが、本番環境(LMDeploy)では不要になる可能性があります。

---

## 4. 今後のアクションプラン (Next Steps)

### 直近のタスク (Today/Tomorrow)
1.  **インフラ修復**:
    - `start_kotaro.sh` を修正し、`scripts/launch_qwen2.py` を経由して LMDeploy を起動するように変更する。
2.  **APIポート整理**:
    - `api/main.py` のポートを `8001` に変更するか、`kotaro_api.py` に統合する。
3.  **ベンチマーク改善**:
    - `kotaro_scoring_v4.py` のロジックを見直し、P06/P11/P12 への極端な偏りを是正する（フラグの重み調整）。

### 中期目標
1.  **Next.js 完全移行**:
    - 画像編集機能 (`ImageEditor.tsx`) のバックエンド接続。
    - `api/` ディレクトリの機能を Next.js の API Routes または Python バックエンドに完全移譲。

---
*Report generated by Jules (AI Agent)*
