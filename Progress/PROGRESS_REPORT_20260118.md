# 進捗管理レポート (2026-01-18)

## 1. プロジェクト概要
**プロジェクト名**: X-AUTO-POST-SYSTEM-otakuDJ
**目的**: イベント写真自動投稿システム（"CANDY虎太郎"ペルソナによる18文字エモコメント生成）
**現状ステータス**: フェーズ2.5（Refinement & Integration） - 統合とロジック整合性の確保

現在、生成ロジックとスコアリングロジックの不整合解消（Phase 2.5）および、レガシーアーティファクトのクリーンアップに焦点を当てています。特に、推論バックエンドのLMDeployへの完全移行と、APIサーバーのポート競合解消が急務です。

---

## 2. コンポーネント別進捗詳細

### 🤖 AI エンジン (Kotaro Engine)
**ステータス: ⚠️ 構成不整合あり (Transitioning)**
- **Backend Transition**:
  - `start_kotaro.sh` が依然として **Ollama** を起動する設定になっています。
  - 戦略上は **LMDeploy** (`scripts/launch_qwen2.py` port 23334) への移行が決定されており、ここが最大のボトルネックです。
- **Vision Core**:
  - `vision_core.py` (MiniCPM-V 2.6 int4) はスタンドアロンで動作確認済みですが、メインパイプライン (`kotaro_api.py`) と統合されていません。

### ☁️ クラウド連携 & API
**ステータス: ⚠️ ポート競合 (Critical)**
- **Double Management**:
  - `kotaro_api.py` (Local LLM用) と `api/main.py` (Gemini用) が共に **Port 8000** を使用しており、同時起動が不可能です。
  - フロントエンド (`next-app`) からの接続先が曖昧になる原因となっています。

### 💻 フロントエンド
**ステータス: 🏗️ 開発中 (Next.js)**
- **TextEditor**: `ScoringVisualization.tsx` 等の実装が進んでいますが、接続先のAPIサーバーが不安定（ポート競合のため）です。
- **ImageEditor**: AI生成連携 (`onGenerateComment`) が未実装のままです。

---

## 3. コードベースレビュー結果 (Daily Review)

### ⚠️ クリティカルな課題

1.  **起動スクリプトの不整合**
    - `start_kotaro.sh` の内容が古く、`ollama serve` を実行しています。
    - **修正案**: `scripts/launch_qwen2.py` を呼び出す形に書き換え、LMDeployバックエンドを正とすべきです。

2.  **APIポートの重複**
    - `kotaro_api.py`: `port=8000`
    - `api/main.py`: `port=8000`
    - **修正案**: `kotaro_api.py` を 8001 に変更するか、単一のエントリーポイントに統合する必要があります。

3.  **依存関係の不一致**
    - `requirements-kotaro.txt` に `ollama` が含まれていますが、今後は `lmdeploy` が主役となります。依存パッケージの整理が必要です。

### 🗑️ クリーンアップ対象
- **`kotaro_v2.py`**: ルートディレクトリに放置されています。`deprecated/` への移動を推奨します。
- **`start_kotaro.sh`**: 内容を刷新するか、`scripts/` 内のスクリプトへのシンボリックリンクに変更すべきです。

---

## 4. 今後のアクションプラン (Next Steps)

### 短期目標 (本日〜明日)
1.  **起動スクリプトの修正**:
    - `start_kotaro.sh` を修正し、WSL環境下で `scripts/launch_qwen2.py` (LMDeploy) を正しく起動するように変更する。
2.  **ポート競合の解消**:
    - `kotaro_api.py` のデフォルトポートを `8001` に変更し、フロントエンドの接続先設定を見直す。
3.  **レガシーファイルの隔離**:
    - `kotaro_v2.py` を `deprecated/` に移動。

### 中期目標 (今週中)
1.  **Vision Core統合**:
    - `kotaro_api.py` から `vision_core.py` の機能を呼び出せるようにし、画像解析→コメント生成のフローを一本化する。
2.  **Next.js連携**:
    - フロントエンドからポート8001へのプロキシ設定、または直接接続の確立。

---
*Report generated by Jules (AI Agent)*
