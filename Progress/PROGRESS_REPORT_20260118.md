# 🐯 Kotaro Engine - Daily Progress Report

**Date:** 2026-01-18
**Author:** Jules (Lead Engineer)
**Phase:** 2.5 - Refinement & Integration
**Status:** ⚠️ Critical Blockers Identified

## 1. 🔍 Daily Code Review Summary

本日（2026-01-18）の定例コードレビューを実施しました。以下の重大な不整合が確認され、エンジンの正常起動が不可能な状態です。

### 🚨 Critical Issues (Blockers)

1.  **起動スクリプトの致命的な不整合 (`start_kotaro.sh`)**
    *   **現状:** `ollama serve` を起動し、ポート11434で待機する仕様になっています。
    *   **問題:** バックエンド `kotaro_api.py` は `http://localhost:23334/v1` (LMDeploy) を参照しているため、このスクリプトで起動してもAPIは機能しません。
    *   **対応:** Ollama依存を削除し、`scripts/launch_qwen2.py` (または同等のLMDeployコマンド) を起動するように修正が必要です。

2.  **APIポートの競合 (Port 8000)**
    *   **現状:** `kotaro_api.py` が `port=8000` で起動します。
    *   **問題:** 既存の `api/main.py` (Gemini Proxy) も `port=8000` を使用しているという報告があり、同時に起動すると競合します。
    *   **対応:** `kotaro_api.py` のポートを `8001` 等に変更するか、Gatewayを設けて統合する必要があります。

3.  **バージョン表記の混乱**
    *   `kotaro_api.py`: ヘッダーは `V3.0` ですが、コード内は `V4.2`、使用しているスコアラーは `KotaroScorerV4` です。
    *   開発実態とドキュメント（コード内コメント）が乖離しています。

### ⚠️ Technical Debt (Frontend)

*   **`ImageEditor.tsx` の未実装箇所:**
    *   `onGenerateComment` が `console.log` のみで、バックエンドと接続されていません。
    *   `api/cameko-search` などのエンドポイントが Next.js 側に存在するか確認が必要です（Python側には見当たりません）。

---

## 2. 📈 Progress Status

| Task | Status | Note |
| :--- | :--- | :--- |
| **Backend Integration** | 🛑 **BLOCKED** | Startup script launches wrong backend (Ollama). |
| **Scoring Logic** | ✅ **Stable** | V4.6.1 logic implemented in `kotaro_scoring_v4.py`. |
| **Frontend UI** | ⚠️ **Partial** | `ImageEditor` UI is ready but actions are unconnected. |
| **Vision Core** | ⚠️ **Isolated** | `vision_core.py` (MiniCPM-V) exists but is not called by `kotaro_api.py`. |

---

## 3. 📅 Next Actions (Priority)

直ちに以下の修正作業に着手することを推奨します：

1.  **[High] `start_kotaro.sh` の修正**: Ollama起動処理を廃止し、Qwen/LMDeploy起動処理へ置き換える。
2.  **[High] Port Conflict Resolution**: `kotaro_api.py` のポートを `8001` に変更し、Next.js側の参照先も更新する。
3.  **[Medium] API Cleanup**: `kotaro_api.py` のヘッダー情報とバージョン定義を実態に合わせて更新する。

---
*Report generated by Jules at 2026-01-18.*
