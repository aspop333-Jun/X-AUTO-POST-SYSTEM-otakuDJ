# プロジェクト進捗報告 (2026-01-29)

## 1. フェーズステータス
**現在地:** Phase 3: UI Integration & API Unification (API統合とインフラ整備)
**進捗率:** 60%

- **完了済:** フロントエンドUI実装 (`TextEditor.tsx`), 基本的なQwen2-VLパイプライン
- **進行中:** VLM (MiniCPM-V) 統合, スコアリングロジックの調整 (V4.7対応)
- **未着手:** VRAM排他制御 (Model Manager), 本番環境デプロイ準備

## 2. コードレビュー結果 (本日の実施)
本日の定期コードレビューの結果、以下の課題と現状が確認されました。

### A. バックエンド (`kotaro_api.py`, `kotaro_scoring_v4.py`)
*   **VLM統合の未達:**
    *   現在の `kotaro_api.py` は `Qwen2-VL` のみに依存しており、`vision_core.py` (MiniCPM-V) が呼び出されていません。
    *   これにより、詳細な画像分析（キャプション生成など）が欠落しています。
*   **VRAM管理の欠落:**
    *   RTX 4060 (8GB VRAM) 環境下で2つのモデル (Qwen2-VL, MiniCPM-V) を同時にメモリに載せることは不可能です。
    *   リクエストに応じてモデルを入れ替える「モデルスワップ機能（Unload/Load）」の実装が必要です。
*   **スコアリングロジックのバグ (V4.7 Benchmarkより):**
    *   **P06ロック問題:** `f_costume` フラグが検出されると、得点差に関わらず `P06` に固定されるロジック (`main_key = "C"`) が強力すぎます。これが多様性の喪失（P06支配率30%）の主因です。
    *   **高スコアのフォールバック:** スコアが2.0を超えている（例: 2.14）にも関わらず、判定ロジックの不具合により `None` (P11/P12) に落ちるケースが散見されます。

### B. フロントエンド (`TextEditor.tsx`)
*   基本的な生成・表示フローは正常に機能しています。
*   `analysisResult` の可視化コンポーネントも実装済みであり、デバッグに役立っています。

## 3. リスク管理
*   **VRAM OOM (Out Of Memory):** 排他制御なしにMiniCPM-Vを統合しようとすると、確実にOOMが発生しシステムが停止します。
*   **体験の単調化:** 特定パターン (P06, P11, P12) への偏りが著しく、ユーザーが「同じようなコメントばかり」と感じるリスクが高まっています。感情系パターン (P01, P05, P07) の出現率向上が急務です。

## 4. 次のアクション
1.  **VRAM排他制御の実装:** `ModelManager` シングルトンクラスを作成し、推論リクエストごとにモデルを安全に入れ替えるロジックを導入する。
2.  **スコアリング修正:**
    *   `f_costume` の強制ロックを廃止し、純粋なスコア競合（C vs その他）に戻す。
    *   フォールバック判定の閾値とロジックを見直す。
3.  **MiniCPM-V統合:** `kotaro_api.py` から `vision_core.py` を呼び出し、コメント生成の精度向上（またはセカンドオピニオン）に活用する。
