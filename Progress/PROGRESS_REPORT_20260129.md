# 進捗管理レポート (2026-01-29)

## 1. プロジェクト概要
**プロジェクト名**: X-AUTO-POST-SYSTEM-otakuDJ
**目的**: イベント写真自動投稿システム（"CANDY虎太郎"ペルソナによる18文字エモコメント生成）
**現状ステータス**: フェーズ3（UI/UX統合・API一元化）進行中

現在、Next.jsフロントエンドとPythonバックエンド（V4.2/V4.6.1）の統合が進められていますが、バックエンドのポート競合や依存関係の欠落といったインフラレベルの課題が顕在化しています。

---

## 2. コンポーネント別進捗詳細

### 🤖 AI エンジン (Kotaro Engine)
**ステータス: ⚠️ 構成に矛盾あり**
- **Logic (`kotaro_scoring_v4.py`)**:
  - V4.6.1ロジック（Anti-P04 Lock, De-Cluster P01->P03）が実装済み。
  - **課題**: 低スコア時（top1 <= 2.0）に `None` 判定となり、P11/P12（無難系）に偏るバイアスが存在します。
- **API (`kotaro_api.py`)**:
  - V4.2として稼働。LMDeploy (`localhost:23334`) に依存。
  - **課題**: 依存パッケージ `lmdeploy` が `requirements-kotaro.txt` に含まれていません。

### ☁️ クラウド連携 (Legacy/Fallback)
**ステータス: ⚠️ ポート競合**
- **API (`api/main.py`)**:
  - Geminiベースの旧APIが存在。
  - `kotaro_api.py` と同じ `Port 8000` を使用しているため、同時起動が不可能です（**Duality Conflict**）。

### 💻 フロントエンド
**ステータス: 🏗️ 部分的統合**
- **TextEditor (`TextEditor.tsx`)**:
  - `http://localhost:8000/generate` への接続が実装され、スコアリング可視化も統合済み。
- **ImageEditor (`ImageEditor.tsx`)**:
  - `react-cropper` による編集は可能ですが、`onGenerateComment` 等のAI連携機能が未実装（`console.log`のみ）です。

---

## 3. コードベースレビュー結果

### 🚨 緊急対応が必要な課題 (Critical)

1.  **ポート8000の競合 (Duality Conflict)**
    - **詳細**: `kotaro_api.py` (Local/V4) と `api/main.py` (Cloud/V1) が共に `port=8000` でバインドされています。
    - **影響**: バックエンドの起動順序によって動作するAPIが変わり、フロントエンドが混乱します。
    - **推奨**: `kotaro_api.py` をメインとし、`api/main.py` を統合するかポートを変更（例: 8001）する必要があります。

2.  **依存関係の欠落**
    - **詳細**: `requirements-kotaro.txt` に、ローカル推論サーバーの核となる `lmdeploy` が記載されていません。
    - **影響**: 新規環境構築時にバックエンドが起動しません。

### ⚠️ 改善が必要な点 (Improvement)

1.  **スコアリングバイアス (P11/P12 Lock)**
    - `kotaro_scoring_v4.py` 内で、最高スコアが2.0以下の場合に強制的にフラット系（P11/P12）に誘導されるロジックがあります。これがベンチマークにおける偏りの原因となっています。

2.  **UI機能の未実装**
    - `ImageEditor.tsx` のコンテキストメニューにある「AI生成」「Cameko検索」がスタブ状態です。

---

## 4. 今後のアクションプラン (Next Steps)

### 本日のタスク (Today)
1.  **ポート競合の解消**:
    - `kotaro_api.py` を正（Port 8000）とし、旧APIの扱いを決定する。
2.  **依存関係の修正**:
    - `requirements-kotaro.txt` に `lmdeploy` を追加。

### 明日以降 (Tomorrow+)
1.  **スコアリングロジック調整**:
    - 低スコア時の救済措置を見直し、感情系パターン（P01-P10）への分岐チャンスを増やす。
2.  **ImageEditor統合**:
    - 画像編集画面から直接AI生成を呼び出せるように実装する。

---
*Report generated by Kotaro-Agent System*
