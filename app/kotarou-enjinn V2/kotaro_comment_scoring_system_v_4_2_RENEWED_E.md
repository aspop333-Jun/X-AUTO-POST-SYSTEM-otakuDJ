# Kotaro Comment Scoring System V4.0（統合版）
**目的**：画像30枚入力でも **12パターンが極端に偏らない**ように、A〜Eスコアからパターンを決定する。  
**変更点（V3→V4）**：E を「役割と個人の境界揺れ」→ **親近感** に置換（主役化させず、分布散らしの補助に使う）

---

## 0. 用語
- **A〜E**：要素スコア（0〜5）
- **サブ4連単**：A〜D の優先順位（1位>2位>3位>4位）  
  - ※Eは「文体・距離感」の補助であり、**主役（人格）にはしない**
- **12パターン**：コメント生成の型（トリガー＋サブ4連単で決まる）

---

## 1. 定義（A〜E）
### A：表情の確定遅延（余韻・揺らぎ）
「笑顔/真顔が完全に決まり切らず、余白が残る」  
→ 余韻／静けさ／見返したくなる間

### B：視線の意図未決定（構図の迷い）
「目線・構図の主導が散って、どこを見るかが一瞬迷う」  
→ 画面設計／状況情報／視線誘導

### C：顔パーツ感情非同期（二面性・クール）
「目・口・姿勢・ポーズが同じ感情を語っていない」  
→ クール／ギャップ／攻めの演出

### D：緊張と緩和の同時存在（温度）
「緊張感があるのに、どこか柔らかい（またはその逆）」  
→ 安心／色気／落ち着き／“大人”

### E：親近感（距離の近さ）
「話しかけられそう／同じ空間にいる感じ」  
→ 距離感の設計（近い／普通／遠い）

---

## 2. 質問セット（A〜D=各15 + E=4 ＝計64）
> 実装は `{ id: {question, sub} }` で管理する前提

### A（A01〜A15）：表情の確定遅延
- A01: 口元が「笑い切っていない」余白がある
- A02: 目元が少しだけ考え事している
- A03: 笑顔と真顔の中間にいる
- A04: 視線がカメラに固定され切っていない
- A05: 表情より空気（雰囲気）が先に来る
- A06: 目の温度が低めで、余韻が残る
- A07: ふっと息を抜いた瞬間っぽい
- A08: 喜びより「静かな満足」が出ている
- A09: 感情の言い切りがない（曖昧さが魅力）
- A10: 口角の上げ方が控えめで上品
- A11: 頬の力が抜けている
- A12: 表情が固定ポーズより自然寄り
- A13: 目線が“見せる”より“そこにいる”
- A14: カメラを意識しすぎない
- A15: 見返した時に深くなるタイプの顔

### B（B01〜B15）：視線の意図未決定
- B01: 背景情報が強く、目が散る
- B02: 小物（傘/看板/配布物）が視線を引く
- B03: 人混み・ブース背景が主張する
- B04: 画面内に“主役が複数”いる
- B05: 立ち位置がセンターではない
- B06: 余白が多く、状況が語る
- B07: 明暗差で視線が迷う
- B08: カラフルな背景で焦点が揺れる
- B09: 被写体が少し遠く、状況が勝つ
- B10: 見せたい要素（衣装/ロゴ/番号）が多い
- B11: 背景の線（柵/看板）が強い
- B12: 視線誘導の矢印が複数ある
- B13: 構図の“情報量”が多い
- B14: 視線が被写体→背景に流れる
- B15: “一枚で説明”が必要なタイプ

### C（C01〜C15）：顔パーツ感情非同期
- C01: 目は強いが、口元は柔らかい
- C02: 口は笑ってるが、目は冷静
- C03: 目線に攻めがある
- C04: ポーズがキャラクターを背負っている
- C05: 立ち姿が「堂々」
- C06: 表情よりポーズが主張する
- C07: 衣装・演出が強く“役”が前に出る
- C08: 角度（顎/首）がクール寄り
- C09: 余裕のある“見せ方”をしている
- C10: 美人寄りの緊張感がある
- C11: 視線が「勝ちに来てる」
- C12: 色気が「静かに」出ている
- C13: 無邪気より、計算された可愛さ
- C14: かわいいのに、どこか強い
- C15: ギャップ（甘さ×鋭さ）が同居

### D（D01〜D15）：緊張と緩和の同時存在
- D01: 姿勢に芯がある（緊張）
- D02: 肩/首の力が抜けている（緩和）
- D03: 安定した笑顔で安心感がある
- D04: 目線が落ち着いている
- D05: 近寄りやすいのに品がある
- D06: ハッとする緊張感がある
- D07: “慣れ”の余裕がある
- D08: 大人っぽい温度感
- D09: 緊張感があるのに柔らかい
- D10: 柔らかいのに芯がある
- D11: 色気があるが嫌味がない
- D12: さすが感・安定感
- D13: その場を支配する空気がある
- D14: 余裕があるのに距離は近い
- D15: 見る側が落ち着く

### E（E01〜E04）：親近感（ポーズ由来／点数式・上限15）
> **設計意図**：Eは「距離が近い/優しい」などの主観語を廃止し、VLMで判定しやすい**身体所作**に限定する。  
> **採点**：Eは0/1ではなく **点数（加点）**。合計は **最大15点**。  
> **複数人数補正**：複数人数の場合は、(各人のE合計) を合算したうえで **人数で割る**（平均化）。最後に 15点でクリップ。

- E01: **顔 or 頭付近**で手ポーズを決めている …… **5点**
- E02: 顔ではないが、**手でポーズ**を決めている …… **3点**
- E03: **口が閉じていない**（開口） …… **2点**
- E04: **手でハートマーク**を作っている（片手も含む） …… **5点**


---

## 3. スコア算出（0〜5）
- A〜D：各質問は 0/1（該当しない/する）
  - 各要素：15点満点 → **0〜5に正規化**（四捨五入OK）
- E：点数式（E01〜E04の加点）
  - 1人の場合：E_raw = Σ(E01..E04)（最大15）
  - 複数人数の場合：E_raw = (Σ 各人のE_raw) / 人数（平均）
  - E = round(E_raw / 15 * 5)
  - 最後に E を 0〜5 にクリップ

---

## 4. V4 分布散らしパッチ（加点構成）
**狙い**：E（親近感）を主役化せず、偏りが出たときに A/B/C/D へ **微量の二次加点**を流して分布を散らす。

> **重要**：Eの質問ID（E01〜E04）は「所作スコア」であり、二次加点は **E-IDではなく上流フラグ**（`casual_moment` / `nostalgic` / `crowd_venue` / `group_feeling` / `talk_to` / `close_dist` / `costume_strong` / `act_point_or_salute` / `prop_strong` など）で行う。  
> こうすることで、E定義を変更しても分布制御ロジックが崩れない。

### 4.1 二次加点ルール（実装推奨：0.3〜0.7刻み）
- `casual_moment=1` → **A +0.7**
- `nostalgic=1` → **A +0.5**
- `crowd_venue=1` → **B +0.7**
- `group_feeling=1` → **B +0.5** ＋ **C +0.5**
- `talk_to=1` → **D +0.5**
- `close_dist=1` → **D +0.3**
- `costume_strong=1` → **C +0.7**
- `act_point_or_salute=1` → **C +0.5** ＋ **D +0.3**
- `prop_strong=1` → **B +0.7**

> ※二次加点は最大でも「合計+1.5」まで（盛りすぎると別の偏りが発生）

---

## 5. 12パターン（V4：分布制御優先）
> 既存のP01〜P12 IDがあるなら、**中身だけこの定義に寄せる**（IDは維持）

### パターン一覧（トリガー＝主役、サブ4連単＝A〜D順位）
- **P01｜余韻（Soft）**：主役A（D=soft寄り）／サブ：A>D>C>B
- **P02｜余韻（Perform）**：主役A（演出寄り）／サブ：A>C>D>B
- **P03｜構図（Scene）**：主役B（背景強）／サブ：B>D>C>A
- **P04｜構図（Complex）**：主役B（情報量）／サブ：B>C>D>A
- **P05｜クール（Cool）**：主役C（非同期）／サブ：C>D>A>B
- **P06｜キャラ（Character）**：主役C（衣装/役）／サブ：C>B>D>A
- **P07｜対比（Group）**：主役C（複数/関係）／サブ：C>B>A>D
- **P08｜温度（Bright）**：主役D（快活）／サブ：D>B>C>A
- **P09｜温度（Soft）**：主役D（癒し）／サブ：D>A>C>B
- **P10｜温度（Action）**：主役D（アクション）／サブ：D>C>B>A
- **P11｜フラット（Close）**：主役なし（A〜Dが弱い）／サブ：D>B>A>C
- **P12｜フラット（Scene）**：主役なし＋状況優勢／サブ：B>D>C>A

---

## 6. 同点処理（V4準拠）
### 6.1 基本優先（A>B>C>D）
- A〜Dが同点のときは **A>B>C>D** を優先

### 6.2 人格委譲ルール（V4必須）
- **Eが最高点でも**、A〜Dのうち **どれかが3点以上**ある場合は、  
  **2番手（A〜D）を主役として判定**する

### 6.3 P11（フラット）逃がし条件（V4.1確定）
- `max(A,B,C,D) <= 2` のときは **強制でフラット系（P11/P12）**
  - `B >= 2` または `BG強（会場/看板/ステージ）` → **P12**
  - それ以外 → **P11**

---

## 7. テスト手順（この30枚で検証）
### 7.1 期待する分布（目標）
- 30枚で **8〜12パターンが出現**
- 最大でも **1パターンが全体の30%を超えない**（=9枚以上はNG）

### 7.2 調整ノブ（偏ったときに触る場所）
- P08/P09（温度）が多すぎる →  
  - 4章の二次加点で **B/Cに流す量を +0.2〜0.4**
  - もしくは **Dの正規化をやや厳しめ**に（5点化の閾値を上げる）
- P03/P04（構図）が少なすぎる →  
  - B02/B03/B11/B13の重みを +0.1〜0.3
- P06（キャラ）が少なすぎる →  
  - C07/C04/C06の重みを +0.2〜0.5
- P11/P12（フラット）が多すぎる →  
  - フラット判定閾値を `<=2` → `<=1` に変更

---

## 8. 実装メモ（このファイルの使い方）
- このV4を **`kotaro_comment_scoring_system_v_4.md`** として採用
- 既存の  
  `kotaro_4_連単設定値_同点処理_統合版.md`  
  は **6章（同点処理）**に合わせて更新・テストする

---
