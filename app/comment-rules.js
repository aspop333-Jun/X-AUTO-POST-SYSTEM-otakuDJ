/**
 * 一言コメント生成ルール（拡張版 v2）
 * 画像特徴に基づくテンプレート選択システム
 */

const CommentRules = {
    // ========================================
    // 表情・雰囲気タイプ別テンプレート（各20パターン）
    // ========================================

    expressionTemplates: {
        '笑顔': [
            '爽やかな笑顔がとても印象的でした✨',
            '自然な笑顔がブースの雰囲気にぴったりでした✨',
            '柔らかな笑顔に思わず見入ってしまいました✨',
            '優しい笑顔が会場を明るくしていました✨',
            '明るい笑顔がとても魅力的でした✨',
            'はじけるような笑顔が素敵でした✨',
            '素敵な笑顔に癒されました✨',
            '印象的な笑顔でした✨',
            '笑顔がライティングに映えていました✨',
            '温かい笑顔がとても素敵でした✨',
            '笑顔の切り替えが絶妙でした✨',
            'ナチュラルな笑顔に引き込まれました✨',
            '笑顔がその場の空気を和ませていました✨',
            'キラキラした笑顔が印象に残りました✨',
            '笑顔のタイミングが完璧でした✨',
            'チャーミングな笑顔でした✨',
            '笑顔がブースを華やかにしていました✨',
            '自然体の笑顔がとても良かったです✨',
            '笑顔の作り方がプロでした✨',
            '親しみやすい笑顔が素敵でした✨'
        ],
        'クール': [
            '凛とした表情がとても印象的でした✨',
            'クールな雰囲気がブースにマッチしていました✨',
            'キリッとした表情に目を引かれました✨',
            'シャープな視線が印象的でした✨',
            '澄んだ表情が美しかったです✨',
            '芯のある表情が素敵でした✨',
            'キレのある佇まいでした✨',
            '凛とした雰囲気が際立っていました✨',
            'クールビューティーな雰囲気でした✨',
            'スタイリッシュな表情が印象的でした✨',
            '知的な雰囲気が素敵でした✨',
            '落ち着いた表情に引き込まれました✨',
            'ミステリアスな雰囲気がありました✨',
            'クールな中に品がありました✨',
            '凛々しい佇まいでした✨',
            'シックな雰囲気が良かったです✨',
            'スマートな印象でした✨',
            'クールな視線に惹かれました✨',
            '洗練された表情でした✨',
            'エレガントでクールな印象でした✨'
        ],
        '柔らか': [
            '柔らかな表情がとても魅力的でした✨',
            '穏やかな雰囲気に癒されました✨',
            '優しい表情がブースに溶け込んでいました✨',
            '柔らかな視線が印象的でした✨',
            '温かみのある表情でした✨',
            'ふんわりとした雰囲気が素敵でした✨',
            '優しい眼差しに引き込まれました✨',
            '穏やかな佇まいでした✨',
            '柔らかなオーラがありました✨',
            'やさしさが伝わってきました✨',
            'ソフトな印象がとても良かったです✨',
            '柔らかな光に包まれた雰囲気でした✨',
            '癒し系の雰囲気が素敵でした✨',
            '穏やかな微笑みが印象的でした✨',
            '柔らかな色気がありました✨',
            'ナチュラルな柔らかさでした✨',
            'ふわっとした空気感が良かったです✨',
            '柔らかな表情の変化が素敵でした✨',
            '優しげな佇まいでした✨',
            '柔和な雰囲気がブースにマッチしていました✨'
        ],
        '華やか': [
            '華やかな存在感が際立っていました✨',
            '存在感のある佇まいでした✨',
            '華やかな雰囲気がブースを彩っていました✨',
            '際立つ華やかさでした✨',
            '輝くような雰囲気が印象的でした✨',
            '目を引く華やかさがありました✨',
            '印象的な存在感でした✨',
            '艶やかな雰囲気が素敵でした✨',
            '華があって素敵でした✨',
            'ゴージャスな雰囲気でした✨',
            'オーラが際立っていました✨',
            '圧倒的な華やかさでした✨',
            'スター性を感じました✨',
            '華やかさと品が両立していました✨',
            'きらびやかな印象でした✨',
            '華やかな衣装との相性が抜群でした✨',
            '存在感がブースを引き立てていました✨',
            '華やかなオーラに包まれていました✨',
            'グラマラスな雰囲気が素敵でした✨',
            '華やかさが会場で一際目立っていました✨'
        ],
        '自然': [
            '自然体の佇まいがとても魅力的でした✨',
            '落ち着いた雰囲気が素敵でした✨',
            '自然な表情に好感が持てました✨',
            'リラックスした雰囲気が良かったです✨',
            '飾らない魅力がありました✨',
            '等身大の雰囲気が素敵でした✨',
            '自然な佇まいでした✨',
            '落ち着いた表情が印象的でした✨',
            'ありのままの魅力が伝わってきました✨',
            'ナチュラルな良さがありました✨',
            '気取らない雰囲気が素敵でした✨',
            '自然な振る舞いが印象的でした✨',
            'さりげない魅力がありました✨',
            '肩の力が抜けた良い表情でした✨',
            'ナチュラルビューティーでした✨',
            '自然な笑顔が一番素敵でした✨',
            '飾りすぎない美しさがありました✨',
            '素の表情が魅力的でした✨',
            '自然体が一番輝いていました✨',
            'リラックスした佇まいが素敵でした✨'
        ],
        '力強い': [
            '力強い視線に引き込まれました✨',
            '印象的な眼差しでした✨',
            '強い存在感がありました✨',
            '堂々とした佇まいが素敵でした✨',
            '迫力のある表情でした✨',
            'パワフルな雰囲気が印象的でした✨',
            '引き込まれる視線でした✨',
            '圧倒的な存在感でした✨',
            '力強さと美しさが両立していました✨',
            'パワーを感じる佇まいでした✨',
            '強い意志を感じる表情でした✨',
            'エネルギッシュな雰囲気でした✨',
            '力強いポーズが決まっていました✨',
            '存在感で会場を圧倒していました✨',
            '強さと優しさのバランスが良かったです✨',
            'ダイナミックな印象でした✨',
            '力強い眼差しが印象に残りました✨',
            'パワフルな魅力がありました✨',
            '力強さの中に繊細さがありました✨',
            '堂々とした姿が素敵でした✨'
        ]
    },

    // ========================================
    // ポーズ別テンプレート（各10パターン）
    // ========================================

    poseTemplates: {
        '正面': [
            '正面からの表情がとても印象的でした✨',
            'まっすぐな視線が素敵でした✨',
            '正面の佇まいが堂々としていました✨',
            'カメラへの意識が自然でした✨',
            '正面顔がとても美しかったです✨',
            'しっかりとしたアイコンタクトでした✨',
            '正面ポーズの安定感がありました✨',
            'まっすぐな姿勢が印象的でした✨',
            '正面からの存在感が圧倒的でした✨',
            'カメラ目線が完璧でした✨'
        ],
        '斜め': [
            '斜めからのアングルが映えていました✨',
            '横顔のラインが美しかったです✨',
            '斜めの角度が絶妙でした✨',
            '横顔の表情が印象的でした✨',
            '斜めポーズのバランスが良かったです✨',
            '横顔に気品がありました✨',
            '斜めからの雰囲気が素敵でした✨',
            '横顔のシルエットが美しかったです✨',
            '斜めの角度で立体感がありました✨',
            '横顔の美しさが際立っていました✨'
        ],
        '見上げ': [
            '見上げる視線が印象的でした✨',
            '上目遣いが魅力的でした✨',
            '見上げるポーズが可愛らしかったです✨',
            '視線の角度が絶妙でした✨',
            '見上げる表情に惹かれました✨',
            '上目遣いのニュアンスが良かったです✨',
            '見上げる姿が素敵でした✨',
            '上向きの視線が印象的でした✨',
            '見上げるポーズがとても自然でした✨',
            '上目遣いの表情が完璧でした✨'
        ],
        '見下ろし': [
            '伏し目がちな表情が美しかったです✨',
            '見下ろす視線にミステリアスさがありました✨',
            '俯きがちな雰囲気が印象的でした✨',
            'まつ毛のラインが美しかったです✨',
            '伏し目の表情が素敵でした✨',
            '見下ろすポーズに品がありました✨',
            '俯く表情が絵になっていました✨',
            '伏し目がちな雰囲気が魅力的でした✨',
            '見下ろす角度が絶妙でした✨',
            '俯いた表情に情緒がありました✨'
        ]
    },

    // ========================================
    // ライティング別テンプレート（各5パターン）
    // ========================================

    lightingTemplates: {
        '明るい': [
            '明るいライティングに映えていました✨',
            '光に包まれた雰囲気が素敵でした✨',
            '明るい照明との相性が抜群でした✨',
            '光の中で輝いていました✨',
            '明るい空間で一層映えていました✨'
        ],
        'ドラマチック': [
            'ドラマチックなライティングがマッチしていました✨',
            '印象的な陰影が美しかったです✨',
            '光と影のコントラストが素敵でした✨',
            'ドラマチックな雰囲気が印象的でした✨',
            '陰影が表情を引き立てていました✨'
        ],
        'ソフト': [
            '柔らかい光に包まれていました✨',
            'ソフトなライティングが素敵でした✨',
            '優しい光が表情を引き立てていました✨',
            'ふんわりとした光が印象的でした✨',
            'ソフトな光との相性が良かったです✨'
        ]
    },

    // ========================================
    // カテゴリ（場所）別テンプレート（各15パターン）
    // ========================================

    categoryTemplates: {
        'サーキット': [
            'サーキットの空気感にぴったりでした✨',
            'レースクイーンとしての華やかさが素敵でした✨',
            'ピット前の雰囲気にマッチしていました✨',
            'チームカラーとの相性が抜群でした✨',
            'サーキットで一際輝いていました✨',
            'レースの熱気に負けない存在感でした✨',
            'パドックの雰囲気に溶け込んでいました✨',
            'マシンとの相性がぴったりでした✨',
            'サーキットの青空に映えていました✨',
            'レース観戦中も目を引く存在でした✨',
            'ピットウォークで一番輝いていました✨',
            'チームを華やかに彩っていました✨',
            'サーキットの熱気が伝わってきました✨',
            'レースの興奮と共に印象に残りました✨',
            'サーキットでの存在感が圧倒的でした✨'
        ],
        'ブース': [
            'ブースの雰囲気にぴったりでした✨',
            'ブースを華やかに彩っていました✨',
            '展示との相性が抜群でした✨',
            'ブースの世界観にマッチしていました✨',
            'ブースの顔として輝いていました✨',
            '製品との相性がぴったりでした✨',
            'ブースの空気感を引き立てていました✨',
            '展示会場で一際目を引きました✨',
            'ブースの雰囲気を盛り上げていました✨',
            '来場者の視線を集めていました✨',
            'ブースを明るくする存在でした✨',
            '展示内容との調和が素敵でした✨',
            'ブースのコンセプトにマッチしていました✨',
            '会場で一番印象に残りました✨',
            'ブースの魅力を引き出していました✨'
        ],
        '撮影会': [
            'スタジオの雰囲気を味方につけていました✨',
            '撮影会ならではの距離感が良かったです✨',
            'ポージングの完成度が素晴らしかったです✨',
            'カメラとの距離感が絶妙でした✨',
            '撮影慣れした安定感がありました✨',
            'スタジオライティングに映えていました✨',
            '撮影会の雰囲気を楽しんでいる様子が伝わりました✨',
            'ポーズのバリエーションが豊富でした✨',
            '撮影しやすい雰囲気を作っていました✨',
            'カメラへの意識が自然でした✨',
            '撮影会ならではの表情が素敵でした✨',
            'スタジオでの存在感が圧倒的でした✨',
            '撮影を楽しんでいる様子が印象的でした✨',
            'プロ意識の高さを感じました✨',
            '撮影会で一番輝いていました✨'
        ]
    },

    // ========================================
    // 衣装別テンプレート
    // ========================================

    outfitTemplates: {
        'カラフル': [
            'カラフルな衣装がとても似合っていました✨',
            '鮮やかな色合いが素敵でした✨',
            '明るい衣装との相性が抜群でした✨',
            'カラフルな衣装で華やかさ倍増でした✨',
            '色使いがとても印象的でした✨'
        ],
        'エレガント': [
            'エレガントな衣装が素敵でした✨',
            '上品な装いが印象的でした✨',
            '品のある衣装との相性が抜群でした✨',
            'エレガントな雰囲気が素敵でした✨',
            '洗練された衣装が似合っていました✨'
        ],
        'スポーティ': [
            'スポーティな衣装がとても似合っていました✨',
            '活動的な印象が素敵でした✨',
            'スポーティな雰囲気が良かったです✨',
            '動きやすそうな衣装との相性が抜群でした✨',
            '爽やかなスポーティ感が印象的でした✨'
        ],
        'シンプル': [
            'シンプルな衣装が表情を引き立てていました✨',
            'シンプルだからこそ魅力が際立っていました✨',
            'シンプルな装いが素敵でした✨',
            'シンプルな衣装との相性が良かったです✨',
            'シンプルさの中に華がありました✨'
        ]
    }
};

// ========================================
// 特徴に基づくテンプレート選択エンジン
// ========================================

/**
 * 画像解析結果の特徴からコメントを生成
 * @param {object} features - 画像解析で抽出された特徴
 * @param {string} features.expression - 表情タイプ
 * @param {string} features.pose - ポーズ
 * @param {string} features.lighting - ライティング
 * @param {string} features.outfit - 衣装タイプ
 * @param {string} features.category - カテゴリ（場所）
 * @returns {string} 生成されたコメント
 */
function selectTemplate(features = {}) {
    const {
        expression = '笑顔',
        pose = null,
        lighting = null,
        outfit = null,
        category = 'ブース'
    } = features;

    const randomPick = (arr) => arr[Math.floor(Math.random() * arr.length)];

    // 重み付けでテンプレートソースを選択
    // 表情: 50%, カテゴリ: 25%, その他: 25%
    const roll = Math.random() * 100;

    if (roll < 50) {
        // 表情ベース
        const templates = CommentRules.expressionTemplates[expression]
            || CommentRules.expressionTemplates['笑顔'];
        return randomPick(templates);
    } else if (roll < 75) {
        // カテゴリベース
        const templates = CommentRules.categoryTemplates[category]
            || CommentRules.categoryTemplates['ブース'];
        return randomPick(templates);
    } else {
        // その他（ポーズ/ライティング/衣装）をランダムに
        const subRoll = Math.random();

        if (subRoll < 0.33 && pose && CommentRules.poseTemplates[pose]) {
            return randomPick(CommentRules.poseTemplates[pose]);
        } else if (subRoll < 0.66 && lighting && CommentRules.lightingTemplates[lighting]) {
            return randomPick(CommentRules.lightingTemplates[lighting]);
        } else if (outfit && CommentRules.outfitTemplates[outfit]) {
            return randomPick(CommentRules.outfitTemplates[outfit]);
        } else {
            // フォールバック: 表情ベース
            const templates = CommentRules.expressionTemplates[expression]
                || CommentRules.expressionTemplates['笑顔'];
            return randomPick(templates);
        }
    }
}

/**
 * 従来のパラメータからコメントを生成（互換性維持）
 */
function generateRuleBasedComment(params = {}) {
    return selectTemplate({
        expression: params.expressionType || '笑顔',
        category: params.category || 'ブース',
        pose: null,
        lighting: null,
        outfit: null
    });
}

/**
 * 完全ランダムでコメントを生成（フォールバック用）
 */
function generateRandomComment() {
    const randomPick = (arr) => arr[Math.floor(Math.random() * arr.length)];
    const expressions = Object.keys(CommentRules.expressionTemplates);

    return selectTemplate({
        expression: randomPick(expressions)
    });
}

// ========================================
// エクスポート
// ========================================

// Export for ES modules
export { CommentRules, selectTemplate, generateRuleBasedComment, generateRandomComment };

// Browser global
if (typeof window !== 'undefined') {
    window.CommentRules = CommentRules;
    window.selectTemplate = selectTemplate;
    window.generateRuleBasedComment = generateRuleBasedComment;
    window.generateRandomComment = generateRandomComment;
}
