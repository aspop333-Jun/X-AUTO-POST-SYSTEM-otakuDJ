# Kotaro Comment Scoring System V2.3（ドラフト）

## 概要

60個の判定基準で画像を分析し、12パターン＋4サブ属性でスコアリング。

## サブ属性（各15個ずつ = 60個）

| ID | サブ属性 | 説明 |
|----|---------|-----|
| A | きれい | 美しさ、上品さ、洗練 |
| B | かわいい | キュート、愛らしさ、親しみ |
| C | クール | カッコよさ、大人っぽさ、余裕 |
| D | 優しい/親近感 | 温かみ、安心感、距離の近さ |

---

## 12パターン：トリガー＆サブ4連単

※ サブ4連単 = そのパターンにおけるサブ属性の優先順位（1位>2位>3位>4位）
※ かわいい写真が多いため、かわいい#1を6パターンに設定し、トリガーで分散

| パターン | トリガー（決定打） | サブ4連単 | 解説 |
|---------|------------------|----------|-----|
| **P01 直球称賛** | 全身バランス完成＋正面構図 | きれい > クール > かわいい > 親近感 | スタイル・構図の完成度＝「きれい」 |
| **P02 表情フォーカス** | 自然な笑顔・ふと出た表情 | **かわいい** > 親近感 > きれい > クール | 自然な笑顔＝「かわいい」 |
| **P03 目・視線** | 目がキュート・アップ | **かわいい** > きれい > クール > 親近感 | 大きな瞳＝「かわいい」 |
| **P04 透明感・雰囲気** | ふわっと明るい写真 | **かわいい** > きれい > 親近感 > クール | ふわっと＝「かわいい」 |
| **P05 仕草・一瞬反応** | 手のポーズ・動きの余韻 | **かわいい** > 親近感 > クール > きれい | ピース・指ハート＝「かわいい」 |
| **P06 衣装似合い度** | チーム衣装・コスプレが目立つ | きれい > クール > かわいい > 親近感 | 衣装完成度＝「きれい」 |
| **P07 ポーズ完成度** | 決めポーズがバッチリ | クール > きれい > かわいい > 親近感 | プロっぽさ＝「クール」 |
| **P08 イベント感** | 人混み・ブース背景あり | **かわいい** > 親近感 > きれい > クール | 楽しそう＝「かわいい」 |
| **P09 親近感** | 距離が近い構図 | **かわいい** > 親近感 > きれい > クール | 近さ＝親しみ＝「かわいい」 |
| **P10 クール寄り** | 表情控えめ・落ち着き | クール > きれい > 親近感 > かわいい | 大人っぽさ＝「クール」 |
| **P11 ギャップ褒め** | 衣装と表情の差・意外性 | クール > かわいい > きれい > 親近感 | ギャップ＝「クール」 |
| **P12 総括一言** | 完成度高い全体カット・複数人 | 親近感 > きれい > かわいい > クール | 安定感＝「親近感」 |

### サブ4連単の分散確認（新版）

| サブ属性 | #1の数 | 該当パターン |
|---------|-------|-------------|
| **かわいい** | **6** | P02, P03, P04, P05, P08, P09 |
| きれい | 2 | P01, P06 |
| クール | 3 | P07, P10, P11 |
| 親近感 | 1 | P12 |

→ かわいい写真が多くても**6パターン×トリガーで分散**可能 ✅

---

## パターン判定ロジック（フローチャート）

```
[画像入力]
    ↓
[トリガー判定] → 該当パターン候補を絞る
    ↓
[60個の判定基準でスコアリング]
    ↓
[パターンスコア＋サブスコア集計]
    ↓
[最高スコアパターン決定]
    ├── 単独1位 → そのパターンで確定
    └── 同点複数 → サブ4連単で比較
                     ├── 各パターンの#1サブスコアで比較
                     └── まだ同点 → #2サブスコアで比較...
    ↓
[確定パターン＋サブ属性で揺らぎ選択]
    ↓
[コメント出力]
```

---

## 判定基準（60個）ドラフト

### 【A】きれい系（15個）

| ID | 判定基準 | 該当パターン | サブ加点 |
|----|---------|-------------|---------|
| A01 | 正面を向いている | P01, P03 | きれい+3 |
| A02 | 全身が映っている | P01, P07 | きれい+2 |
| A03 | スタイル・曲線が美しい | P01, P06 | きれい+3 |
| A04 | 衣装が明るい色（白/青系） | P04 | きれい+2 |
| A05 | 背景と馴染んでいる | P04, P08 | きれい+2 |
| A06 | ポーズが決まっている | P07 | きれい+3 |
| A07 | 体のラインがきれい | P07 | きれい+2 |
| A08 | 透明感がある（明るい写真） | P04 | きれい+3 |
| A09 | 視線がまっすぐ | P03 | きれい+3 |
| A10 | 黒目が大きく見える | P03 | きれい+2 |
| A11 | 衣装の完成度が高い | P06 | きれい+2 |
| A12 | コスプレ・キャラ衣装 | P06, P11 | きれい+2 |
| A13 | 複数人で映っている | P12 | きれい+1 |
| A14 | チーム衣装・お揃い | P06, P12 | きれい+2 |
| A15 | 写真全体のバランスが良い | P01, P12 | きれい+3 |

---

### 【B】かわいい系（15個）

| ID | 判定基準 | 該当パターン | サブ加点 |
|----|---------|-------------|---------|
| B01 | 笑顔である | P02 | かわいい+3 |
| B02 | にこっとしている | P02 | かわいい+3 |
| B03 | ピースサインをしている | P05 | かわいい+2 |
| B04 | 指ハートをしている | P05 | かわいい+3 |
| B05 | 手を振っている | P05 | かわいい+2 |
| B06 | 口角が上がっている | P02 | かわいい+2 |
| B07 | 目が笑っている | P02, P03 | かわいい+3 |
| B08 | ふわっとした雰囲気 | P02, P04 | かわいい+2 |
| B09 | 何かを持っている（ノベルティ等） | P02, P08 | かわいい+2 |
| B10 | 頬が丸い・柔らかそう | P02 | かわいい+2 |
| B11 | 衣装がピンク・パステル系 | P04 | かわいい+2 |
| B12 | 小物・アクセサリーが可愛い | P05, P06 | かわいい+2 |
| B13 | イベントで楽しそう | P08 | かわいい+2 |
| B14 | 動きのある仕草 | P05 | かわいい+2 |
| B15 | 自然体・作り込みすぎない | P02, P09 | かわいい+2 |

---

### 【C】クール系（15個）

| ID | 判定基準 | 該当パターン | サブ加点 |
|----|---------|-------------|---------|
| C01 | 表情が控えめ | P10 | クール+3 |
| C02 | 落ち着いた雰囲気 | P10 | クール+3 |
| C03 | 大人っぽい | P10 | クール+3 |
| C04 | 衣装が黒・ダーク系 | P06, P10 | クール+2 |
| C05 | クールな視線 | P03, P10 | クール+3 |
| C06 | 余裕がある表情 | P10 | クール+2 |
| C07 | プロっぽさがある | P07, P10 | クール+2 |
| C08 | 決めポーズがバッチリ | P07 | クール+3 |
| C09 | 衣装とポーズの完成度高い | P01, P07 | クール+2 |
| C10 | カッコいい系の衣装 | P06, P07 | クール+2 |
| C11 | キリッとした表情 | P10 | クール+2 |
| C12 | 目力が強い | P03 | クール+3 |
| C13 | サーキット・レース背景 | P08 | クール+1 |
| C14 | 衣装と表情のギャップ | P11 | クール+3 |
| C15 | 意外性がある | P11 | クール+3 |

---

### 【D】優しい/親近感系（15個）

| ID | 判定基準 | 該当パターン | サブ加点 |
|----|---------|-------------|---------|
| D01 | カメラとの距離が近い | P09 | 親近感+3 |
| D02 | 安心感がある表情 | P09 | 親近感+3 |
| D03 | 目線が優しい | P02, P09 | 親近感+2 |
| D04 | ほっとする雰囲気 | P09 | 親近感+2 |
| D05 | 自然な笑顔（作り笑いじゃない） | P02, P09 | 親近感+3 |
| D06 | 話しかけてくれそう | P09 | 親近感+2 |
| D07 | イベント会場の雰囲気 | P08 | 親近感+2 |
| D08 | 人混み・ブース背景 | P08 | 親近感+2 |
| D09 | 思い出感がある | P08, P12 | 親近感+2 |
| D10 | ふとした瞬間を捉えた | P02, P05 | 親近感+2 |
| D11 | 柔らかい雰囲気 | P04, P09 | 親近感+2 |
| D12 | さすが感・安定感 | P12 | 親近感+2 |
| D13 | いつも通りの良さ | P12 | 親近感+2 |
| D14 | グループ・仲間感 | P12 | 親近感+2 |
| D15 | 癒される | P02, P09 | 親近感+3 |

---

## スコア集計ロジック

```python
def analyze_image(image):
    scores = {f"P{i:02d}": 0 for i in range(1, 13)}
    sub_scores = {"きれい": 0, "かわいい": 0, "クール": 0, "親近感": 0}
    
    for criterion in CRITERIA:
        if check_criterion(image, criterion):
            for pattern in criterion["patterns"]:
                scores[pattern] += 1
            sub_scores[criterion["sub_attr"]] += criterion["sub_score"]
    
    # 最高スコアのパターンを取得
    top_pattern = max(scores, key=scores.get)
    
    # 同点の場合はサブスコアで決定
    tied = [p for p, s in scores.items() if s == scores[top_pattern]]
    if len(tied) > 1:
        # サブスコア最高で決定
        top_sub = max(sub_scores, key=sub_scores.get)
        # そのサブ属性に最も寄与するパターンを選択
        ...
    
    return top_pattern, sub_scores
```

---

## 揺らぎの実装

```python
COMMENT_VARIANTS = {
    "P01_直球称賛": {
        "きれい": ["めちゃくちゃきれい…❤", "すごく素敵❤", "ほんと美しい✨"],
        "かわいい": ["めちゃくちゃ可愛い…❤", "可愛すぎ！❤", "かわいい！✨"],
        "クール": ["カッコいい！✨", "決まってる！✨"],
        "親近感": ["すごくいい！❤", "最高！✨"],
    },
    ...
}
```

---

## TODO

- [ ] 60個の判定基準をVLMに投げるプロンプト設計
- [ ] 各パターンのコメントバリエーション（揺らぎ）を5個ずつ作成
- [ ] スコアリングロジックの実装
